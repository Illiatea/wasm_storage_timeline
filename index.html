<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WASM Storage.Timeline Parser</title>
    <script src="wasm_exec.js"></script>
</head>
<body>
<h2>WASM Storage.Timeline Parser</h2>
<button id="loadBinary">Load Binary Data</button>
<pre id="output">Waiting for data...</pre>

<script>
    async function loadWasm() {
        const go = new Go();
        const wasm = await WebAssembly.instantiateStreaming(fetch("storage_timeline.wasm"), go.importObject);
        go.run(wasm.instance);
    }

    async function loadBinaryData() {
        await loadWasm();

        // Fetch binary file
        const response = await fetch(
            "https://google-news-observer-3.hype.dev/timeline/all/strings?schema=google-observer-2&timeLine=677aa3b36ed2282308157319",
            // "https://google-news-observer-3.hype.dev/timeline/all/strings?schema=google-observer-2&timeLine=679159556ed228230815902e",
            {
                method: "GET",
                headers: {
                    "Content-Type": "application/storage-timeline",
                },
            });
        const buffer = await response.arrayBuffer();
        const uint8Array = new Uint8Array(buffer);

        // Parse binary data using WebAssembly
        const records = StorageTimeline.Timeline.parse(uint8Array);

        // Display the result
        document.getElementById("output").textContent = JSON.stringify(records, null, 2);
    }

    // Attach event listener to the button
    document.getElementById("loadBinary").addEventListener("click", loadBinaryData);
</script>
</body>
</html>
